<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AgriChain | Home</title>
  <link rel="stylesheet" href="../style.css" />
  <style>

    section {
      background-image: url("../assets/images/image.png");
      background-size: cover;
      background-position: center;
      padding: 220px 0px;
      text-align: center;
      display: flex;
      height:100vh;
      justify-content:center;
      align-items: center;
      /* position: fixed;
      scrollbar-width: thin;
      scroll-behavior: auto; */
      button{
        background-color: #4CAF50;
        color: white;
        padding: 10px 20px;
        border: none;
        margin: 50px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        max-width: 20vw;
        width: 15vw;

      }
    }

    .dashboard {
      padding: 0px 0px 0px 0px;
      margin: 80px 0px 0px 0px;
      background: rgba(218, 239, 214, 0.5);
      border-radius: 8px;
      height: 70vh;
      width: 80%;
      box-shadow: 0 2px 5px rgba(218, 239, 214, 0.9);
      /* position: relative; */
      scrollbar-width:thin;
      /* margin:520px 0px 0px 0px;
      padding: 140px 0px 0px 0px;;
      position: fixed;
      scroll-behavior: auto; */
      overflow: scroll;
      overflow-x: hidden;
    }

    section h2 {
      font-size: 30px;
      color: #2d572c;
      padding: 20px;
    }

    section p {
      font-size: 18px;
      color: #555;
    }

    a{
      text-decoration: none;
      color: #2d572c;
      border: 2px solid #2d572c;
      padding: 10px 20px;
      border-radius: 5px;
      transition: background-color 0.3s, color 0.3s;
      margin: 10px;
      font-size: 14px;
      font-weight: bold;
      max-width: 15px;
    }

    section button {
      background-color: #4CAF50;
      color: white;
      padding: 10px 20px;
      border: none;
      margin: 50px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
    }

    .back {
      width: 100%;
      height: 100vh;
      object-fit: cover;
      position: absolute;
      top: 0;
      left: 0;
      z-index: -1;
    }

    #produceList{
      margin:5px;
      padding:5px;
    }
    .card{
      margin:15px;
      background-color: #a8d8aa;
      padding:5px;
      width: auto;
      height:fit-content;
      border-radius: 50px;
    }
    

    

  </style>
</head>

<body>
  <header>
    <div class="navbar">
        <img src="../assets/images/ac_logo.png" alt="agrichian logo" class="logo">
      <h1>Welcome <span id="userName"></span></h1>
      <nav>
        <a href="farmer_dashboard.html" onclick="window.location.href='farmer_dashboard.html'">back</a>
        <a href="#" onclick="logout()">Logout</a>
      </nav>
    </div>
  </header>

  <section>
    <img src="../assets/images/image.png" alt="AgriChain Logo" class="back" />
    <div class="dashboard">
          <h2>My Produce Listings</h2>
          <div id="produceList"></div>
          <button class="btn-back" onclick="window.location.href='farmer_dashboard.html'">‚¨Ö Back to Dashboard</button>
    </div>
  </div>
  </section>

  <footer>
    <p>&copy; 2025 AgriChain. All rights reserved.</p>
  </footer>

  <!-- <script>
    const token = localStorage.getItem("token");
    const role = localStorage.getItem("role");
    console.log(localStorage.getItem("token")); // Should not be null
    console.log(localStorage.getItem("role")); // Should be "farmer"

    if (!token || role !== "farmer") {
      sessionStorage.setItem("message", "Only farmers can access their listings.");
      window.location.href = "../index.html";
    }

    const produceList = document.getElementById("produceList");

    fetch("http://localhost:5000/api/produce/my", {
      headers: {
        Authorization: `Bearer ${token}`
      }
    })  
    .then(res => res.json())
    .then(data => {
      if (!Array.isArray(data) || data.length === 0) {
        produceList.innerHTML = '<p class="no-data">No produce posted yet.</p>';
        return;
      }

      data.forEach(item => {
        const imageHTML = item.image 
          ? `<img src="http://localhost:5000${item.image}" alt="${item.title}" style="max-width:150px; border-radius:15px;"/>` 
          : `<p><em>No image uploaded</em></p>`;


        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <h3>${item.title}</h3>
          ${imageHTML}
          <p><strong>Quantity:</strong> ${item.quantity}</p>
          <p><strong>Price per Kg:</strong> ‚Çπ${item.pricePerKg}</p>
          <p><strong>Location:</strong> ${item.location}</p>
          <p><strong>Status:</strong> ${item.isApproved ? "‚úÖ Approved" : item.isRejected ? "‚ùå Rejected" : "‚è≥ Pending"}</p>

          ${item.rejectionReason ? `<p><strong>Reason:</strong> ${item.rejectionReason}</p>` : ""}
        `;
        produceList.appendChild(card);

      });
    })
    .catch(err => {
      console.error(err);
      produceList.innerHTML = '<p class="no-data">Error loading your produce.</p>';
    });
  </script> -->

<script>
  const token = localStorage.getItem("token");

  fetch("http://localhost:5000/api/produce/my", {
    headers: {
      Authorization: `Bearer ${token}`
    }
  })
  .then(res => res.json())
  .then(data => {
    const container = document.getElementById("produceList");

    if (!Array.isArray(data) || data.length === 0) {
      container.innerHTML = "<p>No produce found.</p>";
      return;
    }

    data.forEach(p => {
      const card = document.createElement("div");
      card.className = "card";
      console.log(data);
      card.innerHTML = `
        <h3>${p.title}</h3>
        ${p.image ? `<img src="http://localhost:5000${p.image}" alt="${p.title}" style="max-width:150px;border-radius:15px;" alt="${p.title}" />` : '<em>No image</em>'}
        <p><strong>Quantity:</strong> ${p.quantity}</p>
        <p><strong>Price/Kg:</strong> ‚Çπ${p.pricePerKg}</p>
        <p><strong>Location:</strong> ${p.location}</p>
        <p><strong>Posted By:</strong> ${p.postedBy?.name || 'Unknown'}</p>
        <p><strong>Email:</strong> ${p.postedBy?.email || '-'}</p>
        <p><strong>Status:</strong> ${p.isApproved ? "‚úÖ Approved" : p.isRejected ? "‚ùå Rejected" : "‚è≥ Pending"}</p>
        ${p.rejectionReason ? `<p><strong>Reason:</strong> ${p.rejectionReason}</p>` : ""}
      `;
      // card.innerHTML = `
      //   <h3>${p.title}</h3>
      //   ${p.image ? `<img src="http://localhost:5000${p.image}" alt="${p.title}" style="max-width:150px;border-radius:15px;" alt="${p.title}" />` : '<em>No image</em>'}
      //   <p><strong>Quantity:</strong> ${p.quantity}</p>
      //   <p><strong>Price/Kg:</strong> ‚Çπ${p.pricePerKg}</p>
      //   <p><strong>Location:</strong> ${p.location}</p>
      //   <p><strong>Posted By:</strong> ${p.postedBy?.name || 'Unknown'}</p>
      //   <p><strong>Email:</strong> ${p.postedBy?.email || '-'}</p>
      //   <p><strong>Status:</strong> ${p.isApproved ? "‚úÖ Approved" : p.isRejected ? "‚ùå Rejected" : "‚è≥ Pending"}</p>
      //   ${p.rejectionReason ? `<p><strong>Reason:</strong> ${p.rejectionReason}</p>` : ""}
      //   <div style="margin-top:10px;">
      //     ${(!p.isApproved && !p.isRejected) ? `
      //       <button onclick="approveProduce('${p._id}')">‚úÖ Approve</button>
      //       <button onclick="rejectProduce('${p._id}')">‚ùå Reject</button>
      //     ` : ""}
      //     <button onclick="deleteProduce('${p._id}')" style="background-color:red;color:white;">üóëÔ∏è Remove</button>
      //   </div>
      // `;
      container.appendChild(card);
    });
  })
  .catch(err => {
    console.error("Error:", err);
    document.getElementById("produceList").innerHTML = "<p>Failed to load produce.</p>";
  });

  // function approveProduce(id) {
  //   const token = localStorage.getItem("token");
  //   fetch(`http://localhost:5000/api/produce/admin/update/${id}`, {
  //     method: "PUT",
  //     headers: {
  //       "Content-Type": "application/json",
  //       Authorization: `Bearer ${token}`
  //     },
  //     body: JSON.stringify({
  //       isApproved: true,
  //       isRejected: false,
  //       rejectionReason: ""
  //     })
  //   })
  //   .then(res => res.json())
  //   .then(() => location.reload())
  //   .catch(err => alert("Approval failed"));
  // }

  // function rejectProduce(id) {
  //   const reason = prompt("Enter rejection reason:");
  //   if (!reason) return;

  //   const token = localStorage.getItem("token");
  //   fetch(`http://localhost:5000/api/produce/admin/update/${id}`, {
  //     method: "PUT",
  //     headers: {
  //       "Content-Type": "application/json",
  //       Authorization: `Bearer ${token}`
  //     },
  //     body: JSON.stringify({
  //       isApproved: false,
  //       isRejected: true,
  //       rejectionReason: reason
  //     })
  //   })
  //   .then(res => res.json())
  //   .then(() => location.reload())
  //   .catch(err => alert("Rejection failed"));
  // }

  // function deleteProduce(id) {
  //   if (!confirm("Are you sure you want to delete this produce?")) return;
  //   console.log(id)
  //   const token = localStorage.getItem("token");
  //   fetch(`http://localhost:5000/api/produce/${id}`, {
  //     method: "DELETE",
  //     headers: {
  //       Authorization: `Bearer ${token}`
  //     }
  //   })
  //   .then(res => {
  //     if (res.ok) {
  //       alert("Produce deleted.");
  //       location.reload();
  //     } else {

  //       alert("Failed to delete.");
  //     }
  //   })
  //   .catch(err => alert("Delete error"));
  // }

</script>


</body>
</html>
